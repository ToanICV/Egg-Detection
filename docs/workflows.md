+ Khi khá»Ÿi Ä‘á»™ng, PC á»Ÿ tráº¡ng thÃ¡i `Nghá»‰`. PC gá»­i sang Actor lá»‡nh `Di chuyá»ƒn tiáº¿n`. Actor pháº£n há»“i vá» PC lá»‡nh `ACK` vÃ  PC sáº½ Ä‘i vÃ o tráº¡ng thÃ¡i `Scan and move`
+ Trong tráº¡ng thÃ¡i `Scan and move` PC vá»«a xá»­ lÃ½ áº£nh nháº­n dáº¡ng trá»©ng vá»«a má»—i 1 giÃ¢y gá»­i lá»‡nh `Äá»c tráº¡ng thÃ¡i 1`. 
    + Khi `nháº­n dáº¡ng Ä‘Æ°á»£c trá»©ng` vÃ  cÃ³ `Ã­t nháº¥t 1 quáº£ á»Ÿ giá»¯a khung hÃ¬nh` hoáº·c `khoáº£ng cÃ¡ch tá»›i váº­t cáº£n nhá» hÆ¡n 30 cm` thÃ¬ PC gá»­i lá»‡nh `Dá»«ng` sang Actor, Actor pháº£n há»“i vá» PC lá»‡nh `ACK` vÃ  PC chuyá»ƒn sang tráº¡ng thÃ¡i `Pick up egg`.
        + Trong tráº¡ng thÃ¡i `Pick up egg`, náº¿u cÃ³ nhiá»u trá»©ng thÃ¬ PC sáº½ chá»n 1 quáº£ vÃ  PC gá»­i lá»‡nh `Äiá»u khiá»ƒn nháº·t` sang Arm. Arm sáº½ pháº£n há»“i lá»‡nh `ACK` sang PC. Sau Ä‘Ã³, má»—i giÃ¢y PC gá»­i lá»‡nh `Äá»c tráº¡ng thÃ¡i 2` sang Arm Ä‘á»ƒ kiá»ƒm tra Arm nháº·t xong chÆ°a. Arm sáº½ pháº£n há»“i lá»‡nh `Pháº£n há»“i 2`. Náº¿u Arm nháº·t xong thÃ¬ PC gá»­i tiáº¿p lá»‡nh `Äiá»u khiá»ƒn nháº·t` sang Arm Ä‘á»ƒ tiáº¿p tá»¥c nháº·t cho Ä‘áº¿n khi háº¿t trá»©ng trong khung hÃ¬nh. Khi háº¿t trá»©ng thÃ¬ PC gá»­i sang Actor lá»‡nh `Di chuyá»ƒn tiáº¿n` vÃ  vÃ o tráº¡ng thÃ¡i `Scan and move`
    + Khi `khÃ´ng nhÃ¬n tháº¥y trá»©ng` vÃ  `khoáº£ng cÃ¡ch tá»›i váº­t cáº£n nhá» hÆ¡n 30 cm` thÃ¬ PC gá»­i sang Actor lá»‡nh `Xoay 90 Ä‘á»™`, Actor pháº£n há»“i vá» PC lá»‡nh `ACK` vÃ  PC Ä‘i vÃ o tráº¡ng thÃ¡i `Turn 1st`.
+ Trong tráº¡ng thÃ¡i `Turn 1st`, PC sáº½ Ä‘á»‹nh ká»³ má»—i giÃ¢y gá»­i sang Actor lá»‡nh `Äá»c tráº¡ng thÃ¡i 1`. Actor tráº£ vá» `Tráº¡ng thÃ¡i 1` lÃ  Ä‘ang xoay hoáº·c Ä‘á»©ng yÃªn. Náº¿u Ä‘ang xoay thÃ¬ 1 giÃ¢y tiáº¿p theo láº¡i gá»­i lá»‡nh `Äá»c tráº¡ng thÃ¡i 1` tiáº¿p cÃ²n náº¿u Ä‘á»©ng yÃªn thÃ¬ PC chuyá»ƒn sang tráº¡ng thÃ¡i `Scan only`.
+ Trong tráº¡ng thÃ¡i `Scan only`:
    + Náº¿u nháº­n dáº¡ng Ä‘Æ°á»£c trá»©ng thÃ¬ PC chuyá»ƒn sang tráº¡ng thÃ¡i `Pick up egg`. 
        + Khi á»Ÿ tráº¡ng thÃ¡i `Pick up egg`, náº¿u cÃ³ nhiá»u trá»©ng thÃ¬ PC sáº½ chá»n 1 quáº£ vÃ  PC gá»­i lá»‡nh `Äiá»u khiá»ƒn nháº·t` sang Arm. Arm sáº½ pháº£n há»“i lá»‡nh `ACK` sang PC. Sau Ä‘Ã³, má»—i giÃ¢y PC gá»­i lá»‡nh `Äá»c tráº¡ng thÃ¡i 2` sang Arm Ä‘á»ƒ kiá»ƒm tra Arm nháº·t xong chÆ°a. Arm sáº½ pháº£n há»“i lá»‡nh `Pháº£n há»“i 2`. Náº¿u Arm nháº·t xong thÃ¬ PC gá»­i tiáº¿p lá»‡nh `Äiá»u khiá»ƒn nháº·t` sang Arm Ä‘á»ƒ tiáº¿p tá»¥c nháº·t cho Ä‘áº¿n khi háº¿t trá»©ng trong khung hÃ¬nh. Khi háº¿t trá»©ng thÃ¬ PC gá»­i sang Actor lá»‡nh `Di chuyá»ƒn tiáº¿n` vÃ  vÃ o tráº¡ng thÃ¡i `Scan and move`
    + Náº¿u sau 5 giÃ¢y mÃ  khÃ´ng nháº­n dáº¡ng Ä‘Æ°á»£c trá»©ng thÃ¬ PC gá»­i sang Actor lá»‡nh `Di chuyá»ƒn tiáº¿n`, Actor pháº£n há»“i vá» PC lá»‡nh `ACK` vÃ  PC Ä‘i vÃ o tráº¡ng thÃ¡i `Move only`.
+ Trong tráº¡ng thÃ¡i `Move only`, PC `Ä‘áº¿m ngÆ°á»£c trong 5s` vÃ  gá»­i lá»‡nh `Xoay 90 Ä‘á»™` sang Actor. Actor pháº£n há»“i vá» PC lá»‡nh `ACK` vÃ  PC Ä‘i vÃ o tráº¡ng thÃ¡i `Turn 2nd`. 
+ Trong tráº¡ng thÃ¡i `Turn 2nd`, PC sáº½ Ä‘á»‹nh ká»³ má»—i giÃ¢y gá»­i sang Actor lá»‡nh `Äá»c tráº¡ng thÃ¡i 1`. Actor tráº£ vá» `Tráº¡ng thÃ¡i 1` lÃ  Ä‘ang xoay hoáº·c Ä‘á»©ng yÃªn. Náº¿u Ä‘ang xoay thÃ¬ 1 giÃ¢y tiáº¿p theo láº¡i gá»­i lá»‡nh `Äá»c tráº¡ng thÃ¡i 1` tiáº¿p cÃ²n náº¿u Ä‘á»©ng yÃªn thÃ¬ PC chuyá»ƒn sang tráº¡ng thÃ¡i `Scan and move`.---

## Ghi chú tri?n khai (2025-10)
- Thu m?c `src/serial_io` cung c?p `ActorLink` và `ArmLink` cho giao th?c khung `{0x24 0x24 ... 0x23 0x23}`; `FrameCodec` t? x? lı CRC và ph?c h?i khi d? dài khai báo sai.
- `src/services` ch?a `EventBus` và `CommandScheduler`; các timer chính: `actor_status` (1s), `arm_status` (1s), `scan_only_timeout` (5s), `move_only_countdown` (5s).
- `src/state_machine` tri?n khai `ControlStateMachine` (theo các tr?ng thái tài li?u), `ControlContext` qu?n lı queue nh?t tr?ng, timer và t?a d? Arm, `ControlEngine` n?i serial + scheduler + event bus.
- `src/main.py` publish `DetectionEvent` m?i khung hình (dã l?c ROI) và d? state machine di?u khi?n toàn b? Actor/Arm.
- Ki?m th?: `tests/test_serial_codec.py`, `tests/test_scheduler.py`, `tests/test_state_machine.py` (ch?y `pytest` sau khi cài d?t `pip install pytest`).
- `config/app.yaml` cho phép dùng chung 1 block `control.serial` (có th? m? r?ng thêm `actor`/`arm` n?u c?n c?u hình riêng).
- `camera.device_index` có th? tr? t?i webcam, stream IP ho?c du?ng d?n file ?nh/video; h? th?ng s? t? ch?n ngu?n phù h?p.
